<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perekam Suara Web</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        p {
            text-align: center;
            margin-bottom: 30px;
            opacity: 0.9;
        }
        
        .recorder-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        button {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        #recordButton {
            background-color: #ff4d4d;
            color: white;
        }
        
        #recordButton:hover {
            background-color: #ff3333;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 77, 77, 0.4);
        }
        
        #stopButton {
            background-color: #4a5568;
            color: white;
        }
        
        #stopButton:hover {
            background-color: #2d3748;
            transform: translateY(-2px);
        }
        
        #stopButton:disabled {
            background-color: #718096;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        #saveButton {
            background-color: #48bb78;
            color: white;
        }
        
        #saveButton:hover {
            background-color: #38a169;
            transform: translateY(-2px);
        }
        
        #saveButton:disabled {
            background-color: #9ae6b4;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .visualizer {
            width: 100%;
            height: 120px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .timer {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .recording-status {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .recording-indicator {
            width: 12px;
            height: 12px;
            background-color: #ff4d4d;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .recordings-section {
            margin-top: 30px;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 10px;
        }
        
        .recordings-list {
            display: grid;
            gap: 15px;
        }
        
        .recording-item {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .recording-info {
            flex: 1;
        }
        
        .recording-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .recording-date {
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .recording-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-button {
            padding: 8px 15px;
            font-size: 0.9rem;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .action-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            opacity: 0.7;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .recorder-controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 250px;
            }
            
            .recording-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .recording-actions {
                width: 100%;
                justify-content: flex-end;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Perekam Suara Web</h1>
        <p>Rekam dan simpan suara Anda dengan mudah di perangkat</p>
        
        <div class="recording-status" id="recordingStatus" style="display: none;">
            <div class="recording-indicator"></div>
            <span>Sedang merekam...</span>
        </div>
        
        <div class="visualizer">
            <canvas id="visualizerCanvas"></canvas>
            <div class="timer" id="timer">00:00</div>
        </div>
        
        <div class="recorder-controls">
            <button id="recordButton">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/>
                </svg>
                Mulai Rekam
            </button>
            <button id="stopButton" disabled>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 6h12v12H6z"/>
                </svg>
                Berhenti
            </button>
            <button id="saveButton" disabled>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                </svg>
                Simpan
            </button>
        </div>
        
        <div class="recordings-section">
            <h2 class="section-title">Rekaman Tersimpan</h2>
            <div class="recordings-list" id="recordingsList">
                <div class="empty-state">Belum ada rekaman tersimpan</div>
            </div>
        </div>
    </div>

    <script>
        // Variabel global
        let mediaRecorder;
        let audioChunks = [];
        let audioContext;
        let analyser;
        let dataArray;
        let bufferLength;
        let canvasContext;
        let animationId;
        let recordingStartTime;
        let timerInterval;
        
        // Elemen DOM
        const recordButton = document.getElementById('recordButton');
        const stopButton = document.getElementById('stopButton');
        const saveButton = document.getElementById('saveButton');
        const recordingStatus = document.getElementById('recordingStatus');
        const timer = document.getElementById('timer');
        const recordingsList = document.getElementById('recordingsList');
        const visualizerCanvas = document.getElementById('visualizerCanvas');
        
        // Setup canvas
        canvasContext = visualizerCanvas.getContext('2d');
        visualizerCanvas.width = visualizerCanvas.offsetWidth;
        visualizerCanvas.height = visualizerCanvas.offsetHeight;
        
        // Event listener untuk tombol rekam
        recordButton.addEventListener('click', startRecording);
        stopButton.addEventListener('click', stopRecording);
        saveButton.addEventListener('click', saveRecording);
        
        // Fungsi untuk memulai rekaman
        async function startRecording() {
            try {
                // Meminta izin akses mikrofon
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // Membuat MediaRecorder
                mediaRecorder = new MediaRecorder(stream);
                
                // Setup audio context untuk visualizer
                audioContext = new AudioContext();
                const source = audioContext.createMediaStreamSource(stream);
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);
                source.connect(analyser);
                
                // Event saat data audio tersedia
                audioChunks = [];
                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };
                
                // Event saat rekaman berhenti
                mediaRecorder.onstop = () => {
                    // Menghentikan visualizer
                    cancelAnimationFrame(animationId);
                    
                    // Menghentikan semua track audio
                    stream.getTracks().forEach(track => track.stop());
                    
                    // Menonaktifkan tombol stop dan mengaktifkan tombol save
                    stopButton.disabled = true;
                    saveButton.disabled = false;
                    
                    // Menyembunyikan status rekaman
                    recordingStatus.style.display = 'none';
                    
                    // Menghentikan timer
                    clearInterval(timerInterval);
                    timer.textContent = '00:00';
                };
                
                // Memulai rekaman
                mediaRecorder.start();
                
                // Memulai visualizer
                drawVisualizer();
                
                // Mengatur status tombol
                recordButton.disabled = true;
                stopButton.disabled = false;
                saveButton.disabled = true;
                
                // Menampilkan status rekaman
                recordingStatus.style.display = 'flex';
                
                // Memulai timer
                recordingStartTime = Date.now();
                updateTimer();
                timerInterval = setInterval(updateTimer, 1000);
                
            } catch (error) {
                console.error('Error mengakses mikrofon:', error);
                alert('Tidak dapat mengakses mikrofon. Pastikan Anda memberikan izin akses.');
            }
        }
        
        // Fungsi untuk menghentikan rekaman
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                recordButton.disabled = false;
            }
        }
        
        // Fungsi untuk menyimpan rekaman
        function saveRecording() {
            if (audioChunks.length === 0) {
                alert('Tidak ada rekaman untuk disimpan.');
                return;
            }
            
            // Membuat blob dari data audio
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            
            // Membuat URL untuk blob
            const audioUrl = URL.createObjectURL(audioBlob);
            
            // Membuat nama file dengan timestamp
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const fileName = `rekaman-${timestamp}.wav`;
            
            // Membuat elemen download
            const a = document.createElement('a');
            a.href = audioUrl;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // Menambahkan rekaman ke daftar
            addRecordingToList(fileName, audioUrl);
            
            // Mereset state
            saveButton.disabled = true;
            audioChunks = [];
        }
        
        // Fungsi untuk menggambar visualizer
        function drawVisualizer() {
            animationId = requestAnimationFrame(drawVisualizer);
            
            analyser.getByteFrequencyData(dataArray);
            
            canvasContext.fillStyle = 'rgba(0, 0, 0, 0.1)';
            canvasContext.fillRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);
            
            const barWidth = (visualizerCanvas.width / bufferLength) * 2.5;
            let barHeight;
            let x = 0;
            
            for (let i = 0; i < bufferLength; i++) {
                barHeight = dataArray[i] / 2;
                
                canvasContext.fillStyle = `rgb(${barHeight + 100}, 50, 50)`;
                canvasContext.fillRect(x, visualizerCanvas.height - barHeight, barWidth, barHeight);
                
                x += barWidth + 1;
            }
        }
        
        // Fungsi untuk memperbarui timer
        function updateTimer() {
            const currentTime = Date.now();
            const elapsedTime = Math.floor((currentTime - recordingStartTime) / 1000);
            
            const minutes = Math.floor(elapsedTime / 60).toString().padStart(2, '0');
            const seconds = (elapsedTime % 60).toString().padStart(2, '0');
            
            timer.textContent = `${minutes}:${seconds}`;
        }
        
        // Fungsi untuk menambahkan rekaman ke daftar
        function addRecordingToList(name, url) {
            // Menghapus pesan "Belum ada rekaman" jika ada
            const emptyState = recordingsList.querySelector('.empty-state');
            if (emptyState) {
                recordingsList.removeChild(emptyState);
            }
            
            // Membuat elemen untuk rekaman baru
            const recordingItem = document.createElement('div');
            recordingItem.className = 'recording-item';
            
            // Format tanggal yang lebih mudah dibaca
            const date = new Date();
            const formattedDate = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()} ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;
            
            recordingItem.innerHTML = `
                <div class="recording-info">
                    <div class="recording-name">${name}</div>
                    <div class="recording-date">Direkam pada ${formattedDate}</div>
                </div>
                <div class="recording-actions">
                    <button class="action-button play-button" data-url="${url}">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        Putar
                    </button>
                    <button class="action-button download-button" data-url="${url}" data-filename="${name}">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                        </svg>
                        Unduh
                    </button>
                </div>
            `;
            
            // Menambahkan event listener untuk tombol putar
            const playButton = recordingItem.querySelector('.play-button');
            playButton.addEventListener('click', function() {
                playRecording(this.getAttribute('data-url'));
            });
            
            // Menambahkan event listener untuk tombol unduh
            const downloadButton = recordingItem.querySelector('.download-button');
            downloadButton.addEventListener('click', function() {
                downloadRecording(this.getAttribute('data-url'), this.getAttribute('data-filename'));
            });
            
            // Menambahkan rekaman ke daftar
            recordingsList.appendChild(recordingItem);
        }
        
        // Fungsi untuk memutar rekaman
        function playRecording(url) {
            const audio = new Audio(url);
            audio.play();
        }
        
        // Fungsi untuk mengunduh ulang rekaman
        function downloadRecording(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
        
        // Event listener untuk resize window (mengatur ulang ukuran canvas)
        window.addEventListener('resize', () => {
            visualizerCanvas.width = visualizerCanvas.offsetWidth;
            visualizerCanvas.height = visualizerCanvas.offsetHeight;
        });
    </script>
</body>
</html>